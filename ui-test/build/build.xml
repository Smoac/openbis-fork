<project name="ui-test" default="run-tests" basedir="..">
	<import file="../../build_resources/ant/build-common.xml" />

  <project-classpath name="ecp" classes="${classes}" />
  <project-classpath name="eclipse.cp" classes="${targets}/classes" />

	
	<target name="prepare-gwt">
	    <subant target="prepare-gwt">
	      <fileset dir="../openbis/build" includes="build.xml"/>
	    </subant>
	</target>

	<target name="compile-javascript">
	    <subant target="compile-javascript">
	      <fileset dir="../openbis/build" includes="build.xml"/>
	    </subant>
	</target>
	
	
	<target name="ci" depends="create-webapp, run-tests-ui"/>

	<target name="create-webapp" depends="prepare-gwt, compile-javascript">
    <delete dir="targets" failonerror="true" />
    <mkdir dir="targets/store" />
		<mkdir dir="targets/www" />
    <copy todir="targets/www">
    	<fileset dir="../openbis/targets/www"/> 
    </copy> 

    <copy todir="targets/www">
      <fileset dir="../openbis/targets/dist/webapp"/> 
    </copy> 

	</target>
	
	<target name="run-tests-ui" depends="compile-tests">
		<delete dir="${output.test}" />
		<testng classpath="resource:${ecp}"
		        workingDir="."
		        outputdir="${output.test}"
		        failureproperty="tests.failed">
			<xmlfileset dir="source/java" includes="tests.xml" />
			<jvmarg value="-Xmx2048M" />
			<jvmarg value="-XX:MaxPermSize=512m" />
		</testng>

		<fail if="${tests.failed}" />
	</target>

</project>
