evaluationDependsOn(':commonbase')
evaluationDependsOn(':common')
evaluationDependsOn(':openbis_api')
evaluationDependsOn(':openbis-common')
evaluationDependsOn(':authentication')
evaluationDependsOn(':dbmigration')
evaluationDependsOn(':openbis')
evaluationDependsOn(':datastore_server')

apply from: '../gradle/javaproject.gradle'

dependencies {
	compile project(':common'),
			project(':datastore_server')
			
	testCompile project(path: ':datastore_server', configuration: 'tests')	
	
}

sourceSets {
	test {
		resources {
			srcDirs = ['source/java']
		}
	}
}

jar {
    from('../rtd_phosphonetx/source/sql'){ 
        into("/sql") 
        include "proteomics/**/*.sql" 
    }
}

task systemTestSuite(type: Test) {
    useTestNG()
    options.suites('sourceTest/java/tests_system.xml')
    jvmArgs '-Xmx2048m', '-XX:MaxPermSize=256m'    
    reports.html.destination = file("${project.buildDir}/reports/tests-system")
}

test.dependsOn(systemTestSuite)

task zip(type: Zip) {
	includeEmptyDirs false
    from (jar.archivePath) {
	    into 'datastore_server/lib/'
	    rename 'datastore_server_plugin-proteomics(.*)\\.jar', 'datastore_server_plugin-proteomics.jar'
	}
    
    from (fileTree(dir: 'source/core-plugins', includes:['proteomics/**', 'proteomics-optional/**'], excludes:['**/as/**', '**/package-to-dist'])) {
		into 'core-plugins'    
	}
}
zip.dependsOn jar
build.dependsOn zip

apply from: 'gwtdev.gradle'
