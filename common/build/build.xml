<project name="common" basedir="..">
    <target name="clean">
        <delete dir="${dist}" />
    </target>

    <import file="../../build_resources/ant/build-common.xml" />
    <project-classpath name="ecp" classes="${classes}" />
    <property name="mainfolder" value="common" />
    <property name="jar.file" value="${dist}/common.jar" />
    <property name="lib" value="../libraries" />
    <property name="nativesrc" value="${lib}/filelink/native" />
    <property name="nativeroot" value="${targets}/ant" />
    <property name="native" value="${nativeroot}/native" />

    <property name="dist.common" value="${dist}/${mainfolder}" />
    <property name="dist.common.lib" value="${dist.common}/lib" />


    <target name="ci" depends="build-common.ci, check-dependencies" />

    <target name="jar" depends="compile-tests">
        <mkdir dir="${dist.common.lib}" />
        <build-info revision="revision.number" version="version.number" clean="clean.flag" />
        <echo file="${build.info.file}">${version.number}:${revision.number}:${clean.flag}</echo>
        <copy todir="${native}">
            <fileset dir="${nativesrc}">
                <include name="**/jlink.so" />
            </fileset>
        </copy>
        <recursive-jar destfile="${jar.file}">
            <fileset dir="${classes}">
                <include name="**/*.class" />
                <include name="${build.info.filename}" />
            </fileset>
            <fileset dir="${nativeroot}">
                <include name="**/jlink.so" />
            </fileset>
            <zipfileset src="${lib}/log4j/log4j.jar" />
            <zipfileset src="${lib}/testng/testng-jdk15.jar" />
            <zipfileset src="${lib}/commons-lang/commons-lang.jar" />
            <zipfileset src="${lib}/commons-io/commons-io.jar" />
            <manifest>
                <attribute name="Version" value="${version.number}" />
                <attribute name="Build-Number"
                           value="${version.number} (r${revision.number},${clean.flag})" />
            </manifest>
        </recursive-jar>
    </target>

</project>