<project name="openbis" default="dist" basedir="..">
	<import file="../../build_resources/ant/build-common.xml" />

	<property name="result.dir" value="${targets}/dist" />

	<target name="dist">
		<antcall target="_dist"><param name="project" value="openbis"/></antcall>
		<antcall target="_dist"><param name="project" value="datastore_server"/></antcall>
		<antcall target="_dist"><param name="project" value="deep_sequencing_unit"/></antcall>
		<antcall target="_dist"><param name="project" value="rtd_phosphonetx"/></antcall>
		<antcall target="_dist"><param name="project" value="rtd_yeastx"/></antcall>
		<antcall target="_dist"><param name="project" value="screening"/></antcall>
		<antcall target="_dist"><param name="project" value="eu_basysbio"/></antcall>
		<antcall target="_dist"><param name="project" value="rtd_cina"/></antcall>
		<antcall target="_dist"><param name="project" value="plasmid"/></antcall>
		<antcall target="javadoc"/>
	</target>

	<target name="_dist">
		<exec executable="ant" failonerror="true">
			<arg value="-lib" />
			<arg value="../build_resources/lib/ecj.jar" />
			<arg value="-f" />
			<arg value="../${project}/build/build.xml" />
			<arg value="dist" />
		</exec>
		<copy todir="${result.dir}">
			<fileset dir="../${project}/${dist}" />
		</copy>
	</target>

	<target name="clean">
		<delete dir="${dist}" />
		<antcall target="_clean"><param name="project" value="openbis"/></antcall>
		<antcall target="_clean"><param name="project" value="datastore_server"/></antcall>
		<antcall target="_clean"><param name="project" value="deep_sequencing_unit"/></antcall>
		<antcall target="_clean"><param name="project" value="rtd_phosphonetx"/></antcall>
		<antcall target="_clean"><param name="project" value="rtd_yeastx"/></antcall>
		<antcall target="_clean"><param name="project" value="screening"/></antcall>
		<antcall target="_clean"><param name="project" value="eu_basysbio"/></antcall>
		<antcall target="_clean"><param name="project" value="rtd_cina"/></antcall>
		<antcall target="_clean"><param name="project" value="plasmid"/></antcall>
	</target>

	<target name="_clean">
		<exec executable="ant" failonerror="true">
			<arg value="-lib" />
			<arg value="../build_resources/lib/ecj.jar" />
			<arg value="-f" />
			<arg value="../${project}/build/build.xml" />
			<arg value="clean" />
		</exec>
	</target>
	
	<target name="javadoc">
		  <javadoc 
		      destdir="${result.dir}/javadoc" 
		  	  author="true" 
		  	  use="true" 
		  	  useexternalfile="true"
		  	  source="1.6"
		  	  maxmemory="128M" verbose="true">
		  	
		    <fileset dir="../">
		      <include name="*/source/java/ch/systemsx/cisd/**/api/**/*.java"/>
		    	
		    	<!-- add an exception for the Jython dropbox globally available properties -->
		      <include name="*/source/java/ch/systemsx/cisd/**/etlserver/TopLevelDataSetRegistratorGlobalState.java"/>
		      <include name="*/source/java/ch/systemsx/cisd/**/etlserver/registrator/*.java"/>
		    </fileset>
		  	
		    <classpath>
		      <fileset dir="../libraries">
		        <include name="**/*.jar"/>
		      </fileset>
		      <dirset dir="..">
		        <include name="*/targets/ant/classes"/>
		      </dirset>
		    </classpath>
		  	
		  </javadoc>
	</target>

</project>