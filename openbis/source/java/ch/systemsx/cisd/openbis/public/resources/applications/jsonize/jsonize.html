<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd">

<html>
  <head>
    <title>JSONize screening API test</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.js" type="text/javascript"></script>
    <script type="text/javascript" src="openbis.js"></script>
  </head>
  <body>
    <script type="text/javascript">
      $(document).ready(function(){
        var openbisHost = 'http://127.0.0.1:8888';
        var dssHost = 'http://127.0.0.1:8889'; 
        var openbisContext = 'openbis';
        
        var o = new openbis(openbisHost, openbisContext, dssHost);
          o.screening_tryLoginScreening('admin','password', function(response){
            
            var featureVectorDatasetReference = {
              "@class":".FeatureVectorDatasetReference",
              "permId":"20100925142438333-158190"
            }
            
            var featureVectorDatasetWellReference = {
              "@class": ".FeatureVectorDatasetWellReference",
              "permId":"20100925142438333-158190",
              "wellPosition": {
                "wellColumn": 1,
                "wellRow": 1
              }
            }
            
            var imageDatasetReference = {
                "@class": ".ImageDatasetReference",
                "permId":"20111222081950963-158742"
            }

            o.dss_listAvailableFeatureNames([featureVectorDatasetReference]);   
            o.dss_listAvailableFeatureCodes([featureVectorDatasetReference], function(response){
              o.dss_loadFeatures([featureVectorDatasetReference], response.result);
              o.dss_loadFeaturesForDatasetWellReferences([featureVectorDatasetWellReference], response.result);
            });
            o.dss_listPlateImageReferencesForChannel(imageDatasetReference, [{wellColumn: 1, wellRow: 1}], 'DAPI');
            o.dss_listPlateImageReferencesForChannels(imageDatasetReference, [{wellColumn: 1, wellRow: 1}], ['DAPI','GFP','CY3']);
            o.dss_listImageReferencesForChannel(imageDatasetReference, 'DAPI');
            o.dss_listImageReferencesForChannels(imageDatasetReference, ['DAPI','GFP','CY3']);
            o.dss_listAvailableFeatures([featureVectorDatasetReference]);
            o.dss_listImageMetadata([imageDatasetReference]);
            o.dss_listAvailableImageRepresentationFormats([imageDatasetReference]);
            
              o.screening_listPlates(function(response){
                  o.screening_listFeatureVectorDatasets(response.result, function(){});
                  o.screening_listImageDatasets(response.result, function(){});
                  o.screening_listRawImageDatasets(response.result, function(){});
                  o.screening_listSegmentationImageDatasets(response.result, function(){});
                  o.screening_listPlateWellsForPlate(response.result[1], function(){});
                  o.screening_getPlateSample(response.result[0], function(){});
                  o.screening_listPlateMaterialMapping(response.result, null, function(){});
              });
              
              o.screening_listPlatesForExperiment({
                  "@class": ".ExperimentIdentifier",
                  permId: "20100910161306692-5",
                  spaceCode: "HCS-LAB-BRAGGER",
                  projectCode: "MARTA-PROJECT",
                  experimentCode: "DEMO_SCREEN_01"
              }, function(response){
                  o.screening_listFeatureVectorDatasets(response.result, function(){});
              });
              
              o.screening_getPlateMetadataList([{
                "@class": ".PlateIdentifier",
                permId: "20100917094502305-79298",
                plateCode: "PLATE-132-B", 
                spaceCodeOrNull: "HCS-LAB-BRAGGER"
              }], function(response){
                o.screening_listFeatureVectorDatasets(response.result, function(){});
              });
              
              o.screening_listExperiments(function(response){
                for(var index in response.result){
                  var experiment = response.result[index];
                  if(experiment.experimentCode == 'DEMO_SCREEN_02'){
                    o.screening_listPlatesForExperiment(experiment, function(){});    
                    o.screening_listPlateWellsForExperimentAndMaterial(experiment, {
                        "@class": ".MaterialIdentifier",
                        materialTypeIdentifier: {materialTypeCode: "SIRNA"},
                        materialCode: "10280_1"
                    }, function(){});
                    o.screening_getExperimentImageMetadata(experiment, function(){});
                  }
                }
              });
              
              o.screening_listExperimentsForUser('admin', function(response){
                for(var index in response.result){
                    var experiment = response.result[index];
                    if(experiment.experimentCode == 'DEMO_SCREEN_01'){
                      o.screening_listPlatesForExperiment(experiment, function(){});    
                    }
                }
              });
              
              o.screening_listFeatureVectorDatasets([{
                  "@class": ".PlateIdentifier",
                  permId: "20100917094502305-79298",
                  plateCode: "PLATE-132-B", 
                  spaceCodeOrNull: "HCS-LAB-BRAGGER"
              }], function(){});
              
              o.screening_getDatasetIdentifiers(['20100917120747867-157707', '20100917120809240-157708'], function(){});
              o.screening_listPlateWellsForMaterial({
                      "@class": ".MaterialIdentifier",
                      materialTypeIdentifier: {materialTypeCode: "SIRNA"},
                      materialCode: "10280_1"
              }, function(){});
              
        });
      });
    </script>
  
  </body>
</html>